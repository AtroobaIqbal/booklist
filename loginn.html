<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
    <div class="login-form-container">
        <div id="close-login-btn" class="fas fa-times"></div>
        <form action="">
            <h3>Sign In</h3>
            <span>email</span>
            <input type="email" class="box" placeholder="enter your email">
            <span>password</span>
            <input type="password" class="box" placeholder="enter your password">
            <div class="check-box">
                <input type="checkbox" name="" id="remember-me">
                <label for="remember-me">remember me</label>
            </div>
            <input type="submit" value="sign in" class="btn">
            <p>forgot password? <a href="">click here</a></p>
            <p>don't have an account? <a href="">create a account</a></p>
        </form>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, get, set, ref, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    
        const firebaseConfig = {
          apiKey: "AIzaSyA5UpEpEfaMmlY9Ar_NSw-ZwADB_ZTNcnQ",
          authDomain: "book-list-app-a180b.firebaseapp.com",
          projectId: "book-list-app-a180b",
          storageBucket: "book-list-app-a180b.appspot.com",
          messagingSenderId: "815320865513",
          appId: "1:815320865513:web:273e8c693737ca97032e78",
          measurementId: "G-W2TKP2XHY8"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth(app);
        const dbRef = ref(db);
    
    
        let form = document.getElementById("mainForm");
        let email = document.getElementById("email");
        let password = document.getElementById("password");
        let loginBtn = document.getElementById("login");
        let registerBtn = document.getElementById("registerBtn");
        let fullname = document.getElementById("fullname");
        let signInUser = (evt) => {
          evt.preventDefault();
    
          signInWithEmailAndPassword(auth, email.value, password.value)
            .then((credentials) => {
              console.log("Login successful");
    
              get(child(dbRef, 'UserAuthList/' + credentials.user.uid))
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    console.log(snapshot.val());
                    const userFullname = snapshot.val().fullname;
    
                    sessionStorage.setItem('user-info', JSON.stringify({
                      fullname: userFullname
                    }));
    
                    sessionStorage.setItem('user-creds', JSON.stringify(credentials.user));
                    window.location.href = "./index.html";
                  }
                })
                .catch((err) => {
                  console.log("Error fetching user data:", err.message);
                });
            })
            .catch((err) => {
              alert(err.message);
              console.log(err.code);
              console.log(err.message);
            });
        }
    
    
        // mainForm.addEventListener('submit', signInUser);
        loginBtn.onclick = signInUser;
    
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous">
    </script>
</body>
</html>